{"componentChunkName":"component---src-templates-post-js","path":"/docs/browser_cache_control.html","webpackCompilationHash":"16062e5a5b6c169813ec","result":{"data":{"markdownRemark":{"html":"<p>基本的なことのようで意外と細かいことを理解していなかったりする.\n<a href=\"http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html\">RFC 2616 - 13. Caching in HTTP</a></p>\n<h2 id=\"last-modified-and-if-modified-since\"><a href=\"#last-modified-and-if-modified-since\" aria-label=\"last modified and if modified since permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Last-Modified and If-Modified-Since</h2>\n<p>HTTP レスポンスヘッダーに <code>Last-Modified</code> が付いていると、リクエストに <code>If-Modified-Since</code> が付くようになって、（サーバーが対応していれば）更新されていない場合は <code>304 Not Modified</code> が返ってくる。このキャッシュメカニズムを利用する場合はサーバーと通信する必要はある。 <code>Cache-Control: no-cache</code> や <code>max-age=0</code> はこの動作には影響しないので注意。</p>\n<h2 id=\"etag-and-if-none-match\"><a href=\"#etag-and-if-none-match\" aria-label=\"etag and if none match permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ETag and If-None-Match</h2>\n<p>レスポンスに <code>ETag</code> が付いていると、リクエストに <code>If-None-Match</code> が付与されるようになる。のはずなんだけど、Chrome も Safari も動かないよ... Firefox では動く。 ETag の周りには “” をつけるのかね、普通は。これも罠だな.... ちなみに ETag はユーザのトラッキングにも使えたりする。</p>\n<h2 id=\"cache-control\"><a href=\"#cache-control\" aria-label=\"cache control permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache-Control</h2>\n<p>(HTTP 1.1 以降) public だとか private だとか max-age だとかをカンマ区切りで指定する。</p>\n<h3 id=\"no-store\"><a href=\"#no-store\" aria-label=\"no store permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>no-store</h3>\n<p>レスポンスを保存してはならないことを表す。これが指定されるとリソースのキャッシュは全くされなくなる。</p>\n<h3 id=\"no-cache\"><a href=\"#no-cache\" aria-label=\"no cache permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>no-cache</h3>\n<p>キャッシュが有効であるかの再確認を conditional-request で行わなければならないことを表す。 no-cache という名前だが一切キャッシュされないという意味ではない。一切キャッシュが起こらないのは no-store である。</p>\n<h3 id=\"max-age\"><a href=\"#max-age\" aria-label=\"max age permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>max-age</h3>\n<p>キャッシュの有効性の確認を行わずに、キャッシュを利用して良い期間の長さ。 max-age はあくまで、サーバーに問い合わせないでキャッシュを利用しても良い期限を設定するだけである。max-age を超えるとキャッシュが削除されたりするわけではない。 Last-Modified が設定されている場合、max-age を超えたリソースは If-Modified-Since 付きでリクエストが行われ、304 が返ってくれば引き続きキャッシュが利用される。</p>\n<h2 id=\"expires\"><a href=\"#expires\" aria-label=\"expires permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Expires</h2>\n<p>Expires で指定された時刻まではサーバーへの問い合わせなしでキャッシュの利用を行う。 Cache-Control: max-age が指定されている場合は上書きされる。</p>\n<h2 id=\"pragma-no-cache-cache-control\"><a href=\"#pragma-no-cache-cache-control\" aria-label=\"pragma no cache cache control permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pragma: no-cache, Cache-Control</h2>\n<h2 id=\"vary\"><a href=\"#vary\" aria-label=\"vary permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vary</h2>\n<p>ヘッダの内容が異なっていても、同じ URL のキャッシュが存在すればブラウザはキャッシュを利用する。特定のリクエストヘッダもキャッシュのキーとして利用し、そのヘッダが異なる場合にはキャッシュを利用したくない場合には Vary ヘッダをつける必要がある。<a href=\"http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.6\">13.6 Caching Negotiated Responses</a></p>\n<h2 id=\"google-が推奨するキャッシュの最適化の方法\"><a href=\"#google-%E3%81%8C%E6%8E%A8%E5%A5%A8%E3%81%99%E3%82%8B%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E6%96%B9%E6%B3%95\" aria-label=\"google が推奨するキャッシュの最適化の方法 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Google が推奨するキャッシュの最適化の方法</h2>\n<ul>\n<li><a href=\"https://developers.google.com/speed/docs/insights/LeverageBrowserCaching\">ブラウザのキャッシュを活用する</a>より</li>\n<li>CSS や JavaScript のような頻繁には変化しない外部リソースのキャッシュの最適な設定の指針 by Google</li>\n<li>Expires あるいは max-age を少なくとも 1 ヶ月先、できれば 1 年先に設定する(1 年より大きくするのは RFC 違反らしい)</li>\n<li>JavaScript, CSS の URL にハッシュ値とかバージョン番号とか適当なユニークな値を含むようにして、 更新を行った場合は HTML から参照される JavaScript, CSS の URL が変更し、キャッシュにヒットしないようにする。</li>\n<li>HTML ページ自体のようなブックマークされたり外部からリンクされるようなリソース (URL が変えられないリソース) のキャッシュには向かない。</li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"/docs/browser_cache_control.html/#last-modified-and-if-modified-since\">Last-Modified and If-Modified-Since</a></li>\n<li><a href=\"/docs/browser_cache_control.html/#etag-and-if-none-match\">ETag and If-None-Match</a></li>\n<li>\n<p><a href=\"/docs/browser_cache_control.html/#cache-control\">Cache-Control</a></p>\n<ul>\n<li><a href=\"/docs/browser_cache_control.html/#no-store\">no-store</a></li>\n<li><a href=\"/docs/browser_cache_control.html/#no-cache\">no-cache</a></li>\n<li><a href=\"/docs/browser_cache_control.html/#max-age\">max-age</a></li>\n</ul>\n</li>\n<li><a href=\"/docs/browser_cache_control.html/#expires\">Expires</a></li>\n<li><a href=\"/docs/browser_cache_control.html/#pragma-no-cache-cache-control\">Pragma: no-cache, Cache-Control</a></li>\n<li><a href=\"/docs/browser_cache_control.html/#vary\">Vary</a></li>\n<li><a href=\"/docs/browser_cache_control.html/#google-%E3%81%8C%E6%8E%A8%E5%A5%A8%E3%81%99%E3%82%8B%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E6%96%B9%E6%B3%95\">Google が推奨するキャッシュの最適化の方法</a></li>\n</ul>","frontmatter":{"title":"ブラウザキャッシュの制御","lastmod":"2015-10-26T00:00:00.000Z","enable_toc":null},"fields":{"slug":"/docs/browser_cache_control.html"}},"site":{"siteMetadata":{"title":"yunabe.jp"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/docs/browser_cache_control.html"}}}
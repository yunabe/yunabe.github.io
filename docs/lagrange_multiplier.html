<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ラグランジュの未定乗数法の解説と直感的な証明</title>
  <meta name="description" content="">
  <meta property="fb:admins" content="yunabe">
  <meta property="fb:app_id" content="234187763701556">
  <meta property="og:url" href="http://www.yunabe.jp/docs/lagrange_multiplier.html">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.yunabe.jp/docs/lagrange_multiplier.html">
  <link rel="alternate" type="application/rss+xml" title="" href="http://www.yunabe.jp/feed.xml">
  <script>
    if(location.host=='www.yunabe.jp'){
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-19477574-2', 'yunabe.jp');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
    }
  </script>
</head>


  <body>
    <div class="page-content">
      <div class="wrapper">
        <header class="post-header">
          <h1 class="post-title" itemprop="name headline">ラグランジュの未定乗数法の解説と直感的な証明</h1>
          <p class="post-meta"><time datetime="2019-01-07T00:00:00+09:00" itemprop="datePublished">更新 Jan 7, 2019</time></p>
        </header>
        <div>
  <div style="display:inline-block;width:69px;vertical-align:top;height:61px;margin-bottom:15px">
    <div class="fb-like" data-layout="box_count" data-action="like" data-show-faces="false" data-share="false"></div>
  </div>
  <div style="display:inline-block;width:56px;vertical-align:top;height:61px;margin-bottom:15px">
    <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical"></a>
  </div>
  <div style="display:inline-block;width:50px;vertical-align:top;height:61px;margin-bottom:15px">
    <div class="g-plusone" data-size="tall"></div>
  </div>
  <div style="display:inline-block;width:80px;vertical-align:top;height:61px;margin-bottom:15px">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
  </div>
</div>

        <p>ある関数 <script type="math/tex">f(x,y)</script> を束縛条件 <script type="math/tex">g(x,y)=0</script> の元で最大化あるいは最小化する <script type="math/tex">(x,y)</script> を求める際に用いられるのがラグランジュの未定乗数法(Lagrange Multipliers)です。
ラグランジュの未定乗数法の式</p>

<script type="math/tex; mode=display">L(x,y)=f(x,y)-\lambda g(x,y)</script>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=\frac{\partial L}{\partial \lambda}=0</script>

<p>は一見複雑な見た目をしており特に <script type="math/tex">L(x,y)</script> が何を意味しているのかが分かりにくいと思います。
この文書ではラグランジュの未定乗数法の式が何を意味していて、なぜこれによって束縛条件 <script type="math/tex">g(x,y)=0</script> の元での <script type="math/tex">f(x,y)</script> の最大値（あるいは最小値）を求めることができるのかを直感的に分かりやすいように説明します。</p>

<p>ただし微分、ベクトルに関して高校レベルの数学を理解している必要があります。</p>

<h1 id="ラグランジュの未定乗数法">ラグランジュの未定乗数法</h1>

<h2 id="2次元の場合">2次元の場合</h2>
<p><script type="math/tex">(x,y)</script> が束縛条件 <script type="math/tex">g(x,y)=0</script>をみたす条件下で、ある関数 <script type="math/tex">f(x, y)</script> を最大化（最小化）することを考える。
変数<script type="math/tex">\lambda</script>を導入して関数<script type="math/tex">L(x,y,\lambda)</script>を次のように定義する。</p>

<script type="math/tex; mode=display">L(x,y,\lambda)=f(x,y)-{\lambda}g(x,y)</script>

<p><script type="math/tex">\lambda</script>のことをラグランジュ乗数(Lagrange multiplier)、<script type="math/tex">L(x,y,\lambda)</script>をラグランジュ関数(Lagrange function)と呼ぶ。
ある <script type="math/tex">(x_0, y_0)</script> が束縛条件 <script type="math/tex">g(x,y)=0</script> を満たし <script type="math/tex">f(x, y)</script> を最大化(あるいは最小化)するならば、ある<script type="math/tex">\lambda_0</script>が存在し、
<script type="math/tex">(x_0,y_0,\lambda_0)</script>において</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=\frac{\partial L}{\partial \lambda}=0</script>

<p>が成立する。</p>

<h2 id="n次元の場合"><script type="math/tex">n</script>次元の場合</h2>
<p><script type="math/tex">n</script>個の変数<script type="math/tex">x_1,x_2,\ldots,x_n</script> が 束縛条件 <script type="math/tex">g(x_1,x_2,\ldots,x_n)=0</script> をみたしている場合に、
関数<script type="math/tex">f(x_1,x_2,\ldots,x_n)</script>を最大化する<script type="math/tex">(x_1,x_2,\ldots,x_n)</script>を求めたい。</p>

<script type="math/tex; mode=display">L(x_0,x_1,\ldots,x_n,\lambda)=f(x_1,x_2,\ldots,x_n)-\lambda g(x_1,x_2,\ldots,x_n)</script>

<p>で定義される<script type="math/tex">L</script>対して、<script type="math/tex">f</script>が束縛条件<script type="math/tex">g=0</script>の元で最大化される時</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x_0}=\frac{\partial L}{\partial x_1}=\ldots=\frac{\partial L}{\partial x_n}=\frac{\partial L}{\partial \lambda}=0</script>

<p>が成立する。</p>

<h1 id="式の意味の解説と直感的な証明">式の意味の解説と直感的な証明</h1>
<p>2次元の場合で考えましょう。ラグランジュの未定乗数法で使われる等式を確認のためにもう一度書いておきます。</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=\frac{\partial L}{\partial \lambda}=0</script>

<h2 id="1-fracpartial-lpartial-lambda0の意味">(1) <script type="math/tex">\frac{\partial L}{\partial \lambda}=0</script>の意味</h2>
<p>まず初めに<script type="math/tex">\frac{\partial L}{\partial \lambda}=0</script>の部分ですが、これは単に<script type="math/tex">g(x,y)=0</script>を難しく書きなおしたものに過ぎません。</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial \lambda}=\frac{\partial({f(x,y)-{\lambda}g(x,y)})}{\partial \lambda}=\frac{\partial{f(x,y)}}{\partial \lambda}-\frac{\partial(\lambda g(x,y))}{\partial \lambda}=-g(x,y)=0</script>

<p><script type="math/tex">\frac{\partial L}{\partial \lambda}=0</script>は束縛条件<script type="math/tex">g(x,y)=0</script>を別の方法で表現したものに過ぎないので、<script type="math/tex">(x,y)</script>を解析的に求める上では特に役にはたちません。</p>

<h2 id="2-fracpartial-lpartial-xfracpartial-lpartial-y0の意味">(2) <script type="math/tex">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=0</script>の意味</h2>
<p>ラグランジュ未定乗数法において本当に意味のある部分は</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=0</script>

<p>です。この部分は<script type="math/tex">\lambda</script>の場合と異なり<script type="math/tex">x</script>, <script type="math/tex">y</script> をまとめて解釈すると分かりやすいです。
<script type="math/tex">L</script>を展開して、変形すると</p>

<script type="math/tex; mode=display">\frac{\partial f(x,y)}{\partial x}-\lambda \frac{\partial g(x,y)}{\partial x}=0</script>

<script type="math/tex; mode=display">\frac{\partial f(x,y)}{\partial y}-\lambda \frac{\partial g(x,y)}{\partial y}=0</script>

<p><script type="math/tex">-\lambda</script>の項をそれぞれ右辺に持っていけば、</p>

<script type="math/tex; mode=display">\frac{\partial f(x,y)}{\partial x}=\lambda \frac{\partial g(x,y)}{\partial x}</script>

<script type="math/tex; mode=display">\frac{\partial f(x,y)}{\partial y}=\lambda \frac{\partial g(x,y)}{\partial y}</script>

<p><script type="math/tex">f(x,y)</script>は<script type="math/tex">f</script>として省略して書きつつ、ベクトルで２つの式をまとめると</p>

<script type="math/tex; mode=display">\left(
  \begin{array}{c}
  \frac{\partial f}{\partial x} \\
  \frac{\partial f}{\partial y}
  \end{array}
\right)
=\lambda
\left(
  \begin{array}{c}
  \frac{\partial g}{\partial x} \\
  \frac{\partial g}{\partial y}
  \end{array}
\right)</script>

<p>これはどういう意味でしょうか？
2つのベクトル<script type="math/tex">\vec{a}</script>, <script type="math/tex">\vec{b}</script>がある実数<script type="math/tex">k</script>に対して <script type="math/tex">\vec{a}=k\vec{b}</script>が成り立っているというのは、2つのベクトル<script type="math/tex">\vec{a}</script>, <script type="math/tex">\vec{b}</script>が平行であることを意味します。
つまりラグランジュ未定乗数法の</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=0</script>

<p>はベクトル
<script type="math/tex">\left(
  \begin{array}{c}
  \frac{\partial f}{\partial x} \\
  \frac{\partial f}{\partial y}
  \end{array}
\right)</script>
とベクトル
<script type="math/tex">\left(
  \begin{array}{c}
  \frac{\partial g}{\partial x} \\
  \frac{\partial g}{\partial y}
  \end{array}
\right)</script>
は平行であるということを意味しているのです。</p>

<p>つまりラグランジュ未定乗数法は<script type="math/tex">f(x,y)</script>を最大化する点<script type="math/tex">(x,y)</script>において、
<script type="math/tex">f(x,y)</script>, <script type="math/tex">g(x,y)</script>を偏微分して得られるベクトル<script type="math/tex">\left(
  \begin{array}{c}
  \frac{\partial f}{\partial x} \\
  \frac{\partial f}{\partial y}
  \end{array}
\right)</script>, <script type="math/tex">\left(
  \begin{array}{c}
  \frac{\partial g}{\partial x} \\
  \frac{\partial g}{\partial y}
  \end{array}
\right)</script>
は平行になるといういうことを難解に表現したものに過ぎません。後は偏微分で得られるベクトル
<script type="math/tex">\left(
  \begin{array}{c}
  \frac{\partial f}{\partial x} \\
  \frac{\partial f}{\partial y}
  \end{array}
\right)</script>
が何を意味しているかを理解すればラグランジュの未定乗数法が何を意味していて何故それを使って<script type="math/tex">f(x,y)</script>を最大化する<script type="math/tex">(x, y)</script>を求めることができるのかが理解できます。</p>

<h2 id="勾配-gradient法線ベクトル">勾配 (gradient)，法線ベクトル</h2>
<p><script type="math/tex">\left(
  \begin{array}{c}
  \frac{\partial f}{\partial x} \\
  \frac{\partial f}{\partial y}
  \end{array}
\right)</script> のことを専門用語で<a href="https://ja.wikipedia.org/wiki/%E5%8B%BE%E9%85%8D_(%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E8%A7%A3%E6%9E%90)">勾配 (Gradient)</a>と呼び、
<script type="math/tex">\nabla f</script>と表記します。
つまりラグランジュの未定乗数法は、<script type="math/tex">f(x,y)</script>を最大化する点において<script type="math/tex">f(x,y)</script>, <script type="math/tex">g(x,y)</script>のそれぞれの勾配<script type="math/tex">\nabla f</script>, <script type="math/tex">\nabla g</script>が平行になるということを意味しています。
では勾配<script type="math/tex">\nabla f</script>, <script type="math/tex">\nabla g</script>はどのようなベクトルなのでしょうか。</p>

<p>ある一定値 <script type="math/tex">c</script> に対して <script type="math/tex">f(x,y)=c</script> をみたす<script type="math/tex">(x,y)</script>について考えます。
この<script type="math/tex">(x,y)</script> は <script type="math/tex">(x,y)</script> 平面上の曲線となり、<script type="math/tex">f</script> を山の高さだと思うと関数 <script type="math/tex">f(x,y)</script> の等高線に相当するものになります。</p>

<p>曲線<script type="math/tex">f(x,y)=c</script>上のある点<script type="math/tex">(x,y)</script>から、<script type="math/tex">x,y</script>を微小に<script type="math/tex">(\Delta x,\Delta y)</script>だけ変化させたることを考えます。
<script type="math/tex">(x,y)</script>を微小に変化させた場合の<script type="math/tex">f</script>の変化は偏微分に比例するので</p>

<script type="math/tex; mode=display">f(x+\Delta x,y+\Delta y)\simeq f(x,y)+\frac{\partial f}{\partial x}\Delta x+\frac{\partial f}{\partial y}\Delta y=c+\frac{\partial f}{\partial x}\Delta x+\frac{\partial f}{\partial y}\Delta y</script>

<p>いま <script type="math/tex">(\Delta x,\Delta y)</script> が曲線 <script type="math/tex">f(x,y)=c</script> の接線方向のベクトルだとすると、<script type="math/tex">(\Delta x,\Delta y)</script>だけ移動した点
<script type="math/tex">(x+\Delta x,y+\Delta y)</script>も曲線上の点になるので<script type="math/tex">f(x+\Delta x,y+\Delta y)=c</script>。そのため</p>

<script type="math/tex; mode=display">f(x+\Delta x,y+\Delta y)=c+\frac{\partial f}{\partial x}\Delta x+\frac{\partial f}{\partial y}\Delta y=c</script>

<p>となります。両辺から<script type="math/tex">c</script>を引いて</p>

<script type="math/tex; mode=display">\frac{\partial f}{\partial x}\Delta x+\frac{\partial f}{\partial y}\Delta y=0</script>

<p>ベクトルの内積で表現すると</p>

<script type="math/tex; mode=display">\left(
  \begin{array}{c}
  \frac{\partial f}{\partial x} \\
  \frac{\partial f}{\partial y}
  \end{array}
\right)
\cdot
\left(
  \begin{array}{c}
  \Delta x \\
  \Delta y
  \end{array}
\right)
=
\nabla f
\cdot
\left(
  \begin{array}{c}
  \Delta x \\
  \Delta y
  \end{array}
\right)=0</script>

<p>(ゼロではない) 2つのベクトルの内積が0になるのは、2つのベクトルが直交する時です。
そして<script type="math/tex">\left(
  \begin{array}{c}
  \Delta x \\
  \Delta y
  \end{array}
\right)</script> は曲線 <script type="math/tex">f(x,y)=c</script> の接線方向の微小なベクトルです。その接線方向のベクトルと直交する勾配<script type="math/tex">\nabla f</script>は、すなわち、
<script type="math/tex">f(x,y)=c</script>の<a href="https://ja.wikipedia.org/wiki/%E6%B3%95%E7%B7%9A%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB">法線ベクトル</a>に他なりません。</p>

<p><img src="https://docs.google.com/drawings/d/1XESUU--lehuEyL6Hm9D_N2BFl9BlJkdMqoh-aJjtUjk/pub?w=555&amp;h=416" width="277" height="208" /></p>

<p>そしてラグランジュ未定乗数法の<script type="math/tex">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=0\Leftrightarrow\exists\nabla f=\lambda \nabla g</script>は
<script type="math/tex">f</script> の等高線 <script type="math/tex">f(x,y)=c</script> と束縛条件の曲線 <script type="math/tex">g(x,y)=0</script> のそれぞれの法線ベクトルが平行であることを意味しています。
つまりは2つの曲線が接しているということです。</p>

<p><img src="https://docs.google.com/drawings/d/1Ydac4y9UM-0bodV9Z5mXZYj-hjRRs24Jl0mTiqRXJlQ/pub?w=555&amp;h=416" width="277" height="208" /></p>

<h2 id="なぜ-fxyc-gxy0-が接する必要があるか">なぜ <script type="math/tex">f(x,y)=c</script>, <script type="math/tex">g(x,y)=0</script> が接する必要があるか</h2>
<p>以上より、ラグランジュの未定乗数法が述べていることは言い換えれば、束縛条件 <script type="math/tex">g(x,y)</script> の元で <script type="math/tex">f(x,y)</script> が最大値(あるいは最小値)となる点<script type="math/tex">(x,y)</script>において曲線
<script type="math/tex">g(x,y)=0</script> と <script type="math/tex">f(x,y)=c</script> （<script type="math/tex">c</script>は点<script type="math/tex">(x,y)</script>における<script type="math/tex">f(x,y)</script>の値）が接するということです。</p>

<p>これは逆に考えて(対偶を考えて)、<script type="math/tex">g(x,y)=0</script> と <script type="math/tex">f(x,y)=c</script> が点<script type="math/tex">(x,y)</script>において交差しているならばその点で <script type="math/tex">f(x,y)</script> は最大・最小にはならないと考えれば、直感的に理解できます。</p>

<p><img src="https://docs.google.com/drawings/d/1G-DeP1tVUAcHj8mx-e7Jv30DNyRMq7LFxTm4fdgBVKQ/pub?w=555&amp;h=416" width="277" height="208" /></p>

<p><script type="math/tex">f(x,y)=c</script>で分割された2つの領域の片側は<script type="math/tex">f(x,y)>c</script>となるエリア、もう片側は <script type="math/tex">% <![CDATA[
f(x,y)<c %]]></script> となるエリアです。
上の図のようにもし点<script type="math/tex">(x,y)</script> で <script type="math/tex">g(x,y)=0</script> と <script type="math/tex">f(x,y)=c</script> が交差しているのならば、<script type="math/tex">g(x,y)=0</script>の曲線上に <script type="math/tex">f(x,y) > c</script> となる点と <script type="math/tex">% <![CDATA[
f(x,y) < c %]]></script> となる点が必ず存在することになります。つまり束縛条件 <script type="math/tex">g(x,y)=0</script> をみたしつつ、 <script type="math/tex">f(x,y)</script> を <script type="math/tex">c</script> よりも大きくする点と小さくする点が存在するわけですから、その点においては <script type="math/tex">f(x,y)</script> は最大・最小いずれにもなることはありません。</p>

<h1 id="解説証明まとめ">解説・証明まとめ</h1>
<p>ラグランジュ未定乗数法の式</p>

<script type="math/tex; mode=display">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=\frac{\partial L}{\partial \lambda}=0</script>

<p>の<script type="math/tex">\frac{\partial L}{\partial \lambda}=0</script>の部分は単に束縛条件<script type="math/tex">g(x,y)=0</script>を言い換えたものです。
<script type="math/tex">\frac{\partial L}{\partial x}=\frac{\partial L}{\partial y}=0</script>の部分は<script type="math/tex">f</script>, <script type="math/tex">g</script>の勾配(gradient)<script type="math/tex">\nabla f</script>, <script type="math/tex">\nabla g</script>が平行であることと意味しています。
勾配<script type="math/tex">\nabla f</script>は<script type="math/tex">f(x,y)</script>の等高線の法線ベクトルであるので、<script type="math/tex">\nabla f</script>, <script type="math/tex">\nabla g</script>が平行であるというのは要するに<script type="math/tex">f(x,y)</script>の等高線と<script type="math/tex">g(x,y)</script>の等高線が接していることと同義です。</p>

        <div>
  <div style="display:inline-block;width:69px;vertical-align:top;height:61px;margin-bottom:15px">
    <div class="fb-like" data-layout="box_count" data-action="like" data-show-faces="false" data-share="false"></div>
  </div>
  <div style="display:inline-block;width:56px;vertical-align:top;height:61px;margin-bottom:15px">
    <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical"></a>
  </div>
  <div style="display:inline-block;width:50px;vertical-align:top;height:61px;margin-bottom:15px">
    <div class="g-plusone" data-size="tall"></div>
  </div>
  <div style="display:inline-block;width:80px;vertical-align:top;height:61px;margin-bottom:15px">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
  </div>
</div>

        <div class="fb-comments" data-href="http://www.yunabe.jp/docs/lagrange_multiplier.html"  data-numposts="5"></div>
        <div style="text-align:center">
          <a href="/docs">Home</a>
        </div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li></li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>

    <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.8&appId=234187763701556";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<script src="https://apis.google.com/js/platform.js" async defer>
  {lang: 'ja'}
</script>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
  </body>

</html>

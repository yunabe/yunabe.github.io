<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta property="fb:admins" content="yunabe"/><meta property="fb:app_id" content="234187763701556"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8d493c1f9931ce30113c.css">:root{--accent-color:#2a7ae2}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:16px;color:#333;margin:0}a{text-decoration:none}ol,ul{padding-left:1.2em}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.4.2"/><title data-react-helmet="true">Cookie の仕様とセキュリティ | yunabe.jp</title><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/component---src-templates-post-js-379832561a2948943e17.js"/><link as="script" rel="preload" href="/5-e0a4cbbccbb36c7fddc9.js"/><link as="script" rel="preload" href="/app-d900008bf5271cbee8de.js"/><link as="script" rel="preload" href="/styles-6dc9e1bb46ccd13e3789.js"/><link as="script" rel="preload" href="/webpack-runtime-7e7722e48061b7542db4.js"/><link as="fetch" rel="preload" href="/static/d/640/path---docs-cookie-and-security-html-a-5-e-877-CFn8eSwPOUUtLCl78UYmbCpbbxc.json" crossorigin="use-credentials"/><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-5305161629251914", enable_page_level_ads: true});</script></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><style data-emotion-css="15ux5f4">.css-15ux5f4{position:fixed;top:0;left:0;z-index:20;right:0;background-color:#fff;box-sizing:border-box;border-bottom:1px solid #eaecef;padding:0rem 1rem;line-height:2.2rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}.css-15ux5f4 nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-15ux5f4 nav > div{font-size:0.875rem;color:inherit;font-weight:500;display:inline-block;padding:0 0.5rem;margin:0 0.25rem;border-bottom:3px solid transparent;}.css-15ux5f4 nav > div:hover,.css-15ux5f4 nav > div .hlt{border-bottom:3px solid var(--accent-color);}.css-15ux5f4 nav > div.hlt{border-bottom:3px solid var(--accent-color);}.css-15ux5f4 a{color:inherit;box-sizing:border-box;}</style><header class="css-15ux5f4 e1mn4eq11"><style data-emotion-css="fo4y4d">.css-fo4y4d{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-size:16px;font-weight:bold;}</style><div class="css-fo4y4d e1mn4eq10"><a href="/">yunabe.jp</a></div><nav><div class="hlt"><a href="/docs/">Docs</a></div><div><a href="https://github.com/yunabe">GitHub</a></div><div><a href="https://www.facebook.com/yunabe">Facebook</a></div></nav></header><main><style data-emotion-css="hu7ge8">.css-hu7ge8{padding-top:2rem;padding-left:1.5rem;padding-right:1.5rem;max-width:740px;margin:0 auto;}.css-hu7ge8 p,.css-hu7ge8 ol,.css-hu7ge8 ul{line-height:1.7;}.css-hu7ge8 a{color:var(--accent-color);}.css-hu7ge8 *:not(pre) > code{font-size:0.875em;background-color:rgba(27,31,35,0.05);padding:0.25rem 0.5rem;margin:0;border-radius:3px;}.css-hu7ge8 h1{font-size:2.2rem;}.css-hu7ge8 h3{font-size:1.35rem;}.css-hu7ge8 h2{font-size:1.65rem;padding-bottom:0.3rem;border-bottom:1px solid #eaecef;}.css-hu7ge8 h1,.css-hu7ge8 h2,.css-hu7ge8 h3,.css-hu7ge8 h4,.css-hu7ge8 h5,.css-hu7ge8 h6{padding-top:3rem;margin-top:-2rem;}.css-hu7ge8 img{max-width:100%;}.css-hu7ge8 pre{line-height:1.4;padding:1.25rem 1.5rem;margin:0.85rem 0;border-radius:6px;overflow:auto;font-size:0.875rem;}@media (max-width:419px){.css-hu7ge8 pre{border-radius:0px;margin:0.85rem -1.5rem;}}.css-hu7ge8 code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;}.css-hu7ge8 li > p{margin:0;}.css-hu7ge8 blockquote{font-size:0.9rem;color:#888;border-left:0.5rem solid #dfe2e5;margin:0.5rem 0;padding:0.25rem 0 0.25rem 1rem;}.css-hu7ge8 blockquote > p{margin:0;}.css-hu7ge8 (max-width:419px) pre{margin:0.85rem -1.5rem;border-radius:0;}</style><div class="css-hu7ge8 e4j2fu00"><h1>Cookie の仕様とセキュリティ</h1><div><div><p>このドキュメントの目的は Cookie とは何かを一から説明することではないので、そもそも Cookie とは何で何に使えるのかといった話は<a href="http://ja.wikipedia.org/wiki/HTTP_cookie">Wikipedia の Cookie の記事</a>などを参考にして下さい。 ここでは Cookie がどういうものかは大体理解しているという前提で、仕様の確認をしていきます。</p>
</div><p><b>目次</b></p><div><ul>
<li><a href="/docs/cookie_and_security.html#set-cookie-%E3%83%98%E3%83%83%E3%83%80%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-cookie-%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B">Set-Cookie ヘッダを使って Cookie を保存する</a></li>
<li><a href="/docs/cookie_and_security.html#cookie-%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B">Cookie を参照する</a></li>
<li><a href="/docs/cookie_and_security.html#javascript-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-cookie-%E3%82%92%E4%BF%9D%E5%AD%98%E3%83%BB%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B">JavaScript を使って Cookie を保存・参照する</a></li>
<li>
<p><a href="/docs/cookie_and_security.html#cookie-%E3%81%AE%E5%B1%9E%E6%80%A7">Cookie の属性</a></p>
<ul>
<li><a href="/docs/cookie_and_security.html#domain-%E5%B1%9E%E6%80%A7">domain 属性</a></li>
<li><a href="/docs/cookie_and_security.html#path-%E5%B1%9E%E6%80%A7">path 属性</a></li>
<li><a href="/docs/cookie_and_security.html#max-age-%E3%81%A8-expire">max-age と expire</a></li>
<li><a href="/docs/cookie_and_security.html#secure">secure</a></li>
<li><a href="/docs/cookie_and_security.html#httponly">httponly</a></li>
</ul>
</li>
<li>
<p><a href="/docs/cookie_and_security.html#%E3%81%9D%E3%81%AE%E4%BB%96">その他</a></p>
<ul>
<li><a href="/docs/cookie_and_security.html#%E3%82%AF%E3%83%83%E3%82%AD%E3%83%BC%E3%81%A8-port-%E7%95%AA%E5%8F%B7">クッキーと port 番号</a></li>
</ul>
</li>
<li>
<p><a href="/docs/cookie_and_security.html#cookie-%E3%81%8C%E7%B5%A1%E3%82%80%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E9%96%A2%E4%BF%82%E3%81%AE%E5%95%8F%E9%A1%8C">Cookie が絡むセキュリティ関係の問題</a></p>
<ul>
<li><a href="/docs/cookie_and_security.html#%E9%80%9A%E4%BF%A1%E8%B7%AF%E4%B8%8A%E3%81%A7%E3%81%AE%E3%82%AF%E3%83%83%E3%82%AD%E3%83%BC%E3%81%AE%E6%BC%8F%E6%B4%A9">通信路上でのクッキーの漏洩</a></li>
<li><a href="/docs/cookie_and_security.html#%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0-cross-site-scripting-xss">クロスサイトスクリプティング (Cross Site Scripting, XSS)</a></li>
</ul>
</li>
</ul></div><div><h2 id="set-cookie-ヘッダを使って-cookie-を保存する"><a href="#set-cookie-%E3%83%98%E3%83%83%E3%83%80%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-cookie-%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B" aria-label="set cookie ヘッダを使って cookie を保存する permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Set-Cookie ヘッダを使って Cookie を保存する</h2>
<p>Cookie を設定する一番基本的な方法は HTTP ヘッダ の Set-Cookie を使う方法です。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: name=value</code></pre></div>
<p>のような HTTP header をサーバから返すと name と value のペアがブラウザに保存されて、後からそれを参照することができます。
<code>Set-Cookie</code> に属性をつけて保存期間や Cookie が送信される条件などを制御することも可能です。
属性をつけるには、 <code>" ;max-age=3600"</code> や <code>" ;Secure"</code> のように <code>"; "</code> + 属性名 + <code>"="</code> + 属性の値を後ろに追加します。
(厳密には <code>;</code> の後ろには半角スペースが必要で末尾には <code>;</code> は付けません。多くのブラウザは半角スペースを削除したり末尾に不要な <code>;</code> をつけても問題なく動くでしょうが)</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: name=value; max-age=3600; Secure</code></pre></div>
<p>これは、name=value というクッキーを 3600 秒間保存しておきなさい、ただしそのクッキーが利用できるのは https のページでのみです、 と指定してることになります。</p>
<p>複数の name-value のペアを設定したい場合は Set-Cookie ヘッダを複数送ります。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: name0=value0
Set-Cookie: name1=value1</code></pre></div>
<h2 id="cookie-を参照する"><a href="#cookie-%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B" aria-label="cookie を参照する permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cookie を参照する</h2>
<p><code>Set-Cookie</code> で保存された Cookie は、HTTP Request の Cookie ヘッダとしてブラウザからサーバーに送信されます。 Cookie ヘッダは</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Cookie: name=0=value0; name1=value1</code></pre></div>
<p>のように、ブラウザに保存されているクッキーの name=value のペアを <code>"; "</code> で連結したものものになります。
どのクッキーがサーバーに対して送信されるかは、Set-Cookie で指定した max-age や Secure などの属性によって制御することができます。
Secure が指定されていれば、サーバーが https の時にしか送信されないし、 max-age を超えた古くなったクッキーも送信されません(ブラウザから削除されます)。</p>
<p>Cookie ヘッダでブラウザから送信されるクッキーの順序は以下のように決まります。</p>
<ul>
<li>後述する path 属性のなるべく長いものが前に来る</li>
<li>path 属性の長さが同じ場合は、最近作られたものが前に来る</li>
</ul>
<p>また後述するように、クッキーは name が同一でも <code>domain</code>, <code>path</code> 属性の値が異なれば別のものとして扱われるので、<strong>同じ name のクッキーが複数 Cookie ヘッダの中に現れることがありうる</strong>ので注意してください。例えば、www.example.com にあるサーバーが</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: myname=value0; example.com; path=/
Set-Cookie: myname=value1; www.example.com; path=/</code></pre></div>
<p>という Set-Cookie でクッキーを設定した場合、ブラウザは</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: myname=value1; myname=value0</code></pre></div>
<p>のように同じ名前の Cookie を２つサーバーに送るようになります。</p>
<h2 id="javascript-を使って-cookie-を保存・参照する"><a href="#javascript-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-cookie-%E3%82%92%E4%BF%9D%E5%AD%98%E3%83%BB%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B" aria-label="javascript を使って cookie を保存・参照する permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JavaScript を使って Cookie を保存・参照する</h2>
<p><code>document.cookie</code> というプロパティを利用して JavaScript からクッキーを設定したり参照することができます。</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">"name=value"</span><span class="token punctuation">;</span></code></pre></div>
<p>のように<code>document.cookie</code>に対して文字列を代入すると、<code>Set-Cookkie: name=value</code>ヘッダをサーバーからブラウザに送信した場合と同じことが起こります。Set-Cookie ヘッダとどうように、属性を付けることができます。</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">"name=value; max-age=3600; Secure"</span><span class="token punctuation">;</span></code></pre></div>
<p>復数のクッキーを指定した場合は、Set-Cookie ヘッダと似たような感じに 1 つずつ代入します。</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">"name0=value0"</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">"name1=value1"</span><span class="token punctuation">;</span></code></pre></div>
<p>クッキーの値を参照するには、 <code>document.cookie</code> プロパティを参照します。<code>document.cookie</code> プロパティは参照すると <code>Cookie</code>ヘッダで送信されるのと同じ文字列を得ることができます。</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// “name=0=value0; name1=value1”</span></code></pre></div>
<p><code>document.cookie</code> は一見すると string 型のプロパティのように見えますが、そうではないことに注意して下さい。<code>document.cookie</code> へ代入した文字列と <code>document.cookie</code>を読んだ時に得られる文字列はまったく異なります。また、<code>document.cookie</code>に空文字を代入しても 空の <code>Set-Cookie</code>を送ったのと同じことにしかならないので何も起こりません。クッキーは削除されず、<code>document.cookie</code>を読んだ時に得られる値も変化しません。</p>
<h2 id="cookie-の属性"><a href="#cookie-%E3%81%AE%E5%B1%9E%E6%80%A7" aria-label="cookie の属性 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cookie の属性</h2>
<h3 id="domain-属性"><a href="#domain-%E5%B1%9E%E6%80%A7" aria-label="domain 属性 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>domain 属性</h3>
<p>Set-Cookie でクッキーをブラウザに保存する際domainという属性を付加することでクッキーが送信される、あるいは<code>document.cookie</code>でクッキーが読み取れる、ドメインを制御することができます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: name=value; domain=example.com</code></pre></div>
<p>domain 属性が指定されている場合、そのクッキーは domain で指定された domain 自体とそのサブドメインに対して送信されます。
上の例の場合、このクッキーは example.com, www.example.com, docs.example.com などのホストに対して送信されます。
一方で domain を指定しない場合は、Set-Cookie を送信したホストにのみクッキーは送信されます。
domain属性なしで、example.com によって設定されたクッキーは www.example.com や docs.example.com には送信されません。
domainを省略した場合と、domain に今接続しているホスト名を指定した場合ではクッキーが送信される範囲が異なる点に注意が必要です。
サブドメインに送信されてはならないクッキーには domain 属性はつけてはなりません。</p>
<p>また domain 属性で指定するドメインは現在のホスト名を含むドメインでなくてはなりません。
そうでない値を指定した場合は無視されます。例えばあるページが
www.example.com にある場合、domain に example.com を指定してクッキーが
example.com 以下のあらゆるホストに対して送信されるように設定できますが、
domain に google.com を指定して google.com
に対してクッキーを送信するように設定することはできません。また、domain 属性に
abc.www.example.com を指定してサブドメイン abc.www.example.com
にのみクッキーが送信されるようにすることもできません。</p>
<p>domain 属性の値の先頭に “.” を付けても構いません。その “.”
は無視されます。 また念の為述べておくと domain に www.example あるいは
www.example. などと指定しても www.example.co.jp と example.com
にクッキーを送信されたりはしません。</p>
<h3 id="path-属性"><a href="#path-%E5%B1%9E%E6%80%A7" aria-label="path 属性 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>path 属性</h3>
<p>クッキーには path 属性を指定することができます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: name=value; path=/mydir</code></pre></div>
<p>のように path 属性を指定するとクッキーは /mydir/ に含まれる URL (e.g.
<a href="http://example.com/mydir/">http://example.com/mydir/</a>, <a href="http://example.com/mydir/index.html">http://example.com/mydir/index.html</a>,
<a href="http://example.com/mydir/subdir/">http://example.com/mydir/subdir/</a>) にのみ送信されます。path
が省略された場合は現在の URL の path が使われます。例えば現在のページが
<a href="http://example.com/mydir/subdir/index.html">http://example.com/mydir/subdir/index.html</a> であれば /mydir/subdir/ が
path
に設定されます。ほとんどの場合、同一ドメインの全てのリクエストでクッキーが送信されるようにしたいと思うので、多くの場合
path=/ を常に指定することになります。path=/
を指定するのをうっかり忘れると、<a href="http://example.com/2014/11/">http://example.com/2014/11/</a>
で指定されたクッキーが <a href="http://example.com/2013/12/">http://example.com/2013/12/</a>
には送信されません。</p>
<p>さて、path も domain
と同じようにクッキーが送信される範囲を制御するので、セキュリティ上重要なように一見すると思えますが、実は
path はセキュリティ保護には利用できません。<a href="http://www.ipa.go.jp/security/awareness/vendor/programmingv2/contents/304.html">IPA の第 4 章
セッション対策</a>
には path をなるべく限定しておいたほうがよいような記述がありますが、path
を限定してもその他の path
にあるリソースからクッキーを読む方法は存在するので気をつけて下さい。セッション ID などを保存するのであれば、普通は
<code>path=/</code> を指定すると思います。</p>
<h3 id="max-age-と-expire"><a href="#max-age-%E3%81%A8-expire" aria-label="max age と expire permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>max-age と expire</h3>
<p>max-age あるいは expire 属性でクッキーの寿命が指定できます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Set-Cookie: name=value; max-age=3600
Set-Cookie: name=value; expires=Tue, 19 Jan 2038 03:14:07 GMT</code></pre></div>
<ul>
<li><code>max-age</code>
ではクッキーの寿命を秒数で指定します。負の値を指定すると、最も過去の日付を指定したことになります。</li>
<li><code>expires</code> では有効期限が切れる日付・時刻を指定します。</li>
<li><code>max-age</code> と <code>expires</code> の両方が指定された場合は <code>max-age</code>
が使用されます。</li>
<li><code>max-age</code> はかなり古いブラウザではサポートされない場合があります。</li>
<li><code>max-age</code>, <code>expires</code>
がなく寿命が指定されていない場合は、クッキーはブラウザが閉じられると削除されます。</li>
</ul>
<h3 id="secure"><a href="#secure" aria-label="secure permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>secure</h3>
<p>うっかり忘れられがちですが、セキュリティ上とても大切な仕様です。 Secure 属性をつけた場合、そのクッキーは接続が https で保護されている場合のみに送信されます。Secure 属性には値は必要ありません。</p>
<p>デフォルトではクッキーは接続が <code>https</code> なのか <code>http</code>
なのかには関係なく動作します。 https 接続で設定されたクッキーであっても
Secure 属性がなければ同じホスト名に http
で接続した場合にもそのクッキーは送信されてしまい、通信経路上にいる第三者に盗聴される可能性があります。
セッション ID のような第三者に盗み見られてはならないクッキーは必ず Secure
属性をつけなくてはなりません。 絶対に忘れないようにしましょう。</p>
<h3 id="httponly"><a href="#httponly" aria-label="httponly permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>httponly</h3>
<p>httponly 属性をつけると、そのクッキーは <code>Cookie</code>ヘッダ以外から読み取ることができなくなりなり、JavaScript から参照できなくなります。
Secure の反対の意味、 http でしか送信されない Cookie という意味では <strong>ない</strong> ので気をつけて下さい。</p>
<p>このオプションは XSS 脆弱性があった場合の被害を小さくします。
XSS 脆弱性によって攻撃者が任意の JavaScript が実行できてしまうと、
<code>document.cookie</code> の値を読んで Session ID
などのログイン情報などを盗み見れてしまう可能性がありますが、
HttpOnly 属性をつけておくとクッキーが XSS
脆弱性によって読み取られることがなくなります。 Session ID などのように
JavaScript から読み取る必要がないクッキーには HttpOnly
を忘れずに付けておいたほうが良いでしょう。</p>
<h2 id="その他"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96" aria-label="その他 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>その他</h2>
<h3 id="クッキーと-port-番号"><a href="#%E3%82%AF%E3%83%83%E3%82%AD%E3%83%BC%E3%81%A8-port-%E7%95%AA%E5%8F%B7" aria-label="クッキーと port 番号 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>クッキーと port 番号</h3>
<h2 id="cookie-が絡むセキュリティ関係の問題"><a href="#cookie-%E3%81%8C%E7%B5%A1%E3%82%80%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E9%96%A2%E4%BF%82%E3%81%AE%E5%95%8F%E9%A1%8C" aria-label="cookie が絡むセキュリティ関係の問題 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cookie が絡むセキュリティ関係の問題</h2>
<h3 id="通信路上でのクッキーの漏洩"><a href="#%E9%80%9A%E4%BF%A1%E8%B7%AF%E4%B8%8A%E3%81%A7%E3%81%AE%E3%82%AF%E3%83%83%E3%82%AD%E3%83%BC%E3%81%AE%E6%BC%8F%E6%B4%A9" aria-label="通信路上でのクッキーの漏洩 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>通信路上でのクッキーの漏洩</h3>
<p>クッキーにセッション ID のような機密情報が含まれる場合、当然ですがクッキーは<code>https</code>を介して行われなければなりません。</p>
<h3 id="クロスサイトスクリプティング-cross-site-scripting-xss"><a href="#%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0-cross-site-scripting-xss" aria-label="クロスサイトスクリプティング cross site scripting xss permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>クロスサイトスクリプティング (Cross Site Scripting, XSS)</h3>
<p>Web アプリケーションでもっともよく問題になる<a href="https://www.google.co.jp/search?q=xss&#x26;hl=ja">クロスサイトスクリプティング</a>は端的に言えば、
ユーザの入力を HTML に変換する際のバグにより悪意のある JavaScript が実行されてしまう問題です。クッキーの処理自体が XSS 脆弱性を引き起こす原因になることはあまりないでしょう。</p>
<p>しかしクッキーの設定によって XSS の脆弱性があった場合の被害を緩和することは可能です。</p></div></div><style data-emotion-css="1fj6yi4">.css-1fj6yi4{margin-top:1rem;margin-bottom:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;font-size:0.875rem;color:#888;}</style><div class="css-1fj6yi4"><div><b>最終更新:</b> <!-- -->3/16/2016</div></div></div></main></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-19477574-2', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-js","jsonName":"docs-cookie-and-security-html-a5e","path":"/docs/cookie_and_security.html"};window.dataPath="640/path---docs-cookie-and-security-html-a-5-e-877-CFn8eSwPOUUtLCl78UYmbCpbbxc";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d900008bf5271cbee8de.js"],"component---src-templates-post-js":["/component---src-templates-post-js-379832561a2948943e17.js"],"pages-manifest":["/pages-manifest-8e7c30eedc2020233eaa.js"]};/*]]>*/</script><script src="/webpack-runtime-7e7722e48061b7542db4.js" async=""></script><script src="/styles-6dc9e1bb46ccd13e3789.js" async=""></script><script src="/app-d900008bf5271cbee8de.js" async=""></script><script src="/5-e0a4cbbccbb36c7fddc9.js" async=""></script><script src="/component---src-templates-post-js-379832561a2948943e17.js" async=""></script></body></html>
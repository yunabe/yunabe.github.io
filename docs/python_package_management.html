<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Python パッケージ管理技術まとめ (pip, setuptools, easy_install, etc)</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.yunabe.jp/docs/python_package_management.html">
  <link rel="alternate" type="application/rss+xml" title="" href="http://www.yunabe.jp/feed.xml">
  <script>
    if(location.host=='www.yunabe.jp'){
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-19477574-2', 'yunabe.jp');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
    }
  </script>
</head>


  <body>
    <div class="page-content">
      <div class="wrapper">
        <header class="post-header">
          <h1 class="post-title" itemprop="name headline">Python パッケージ管理技術まとめ (pip, setuptools, easy_install, etc)</h1>
          <p class="post-meta"><time datetime="2015-01-13T00:00:00+09:00" itemprop="datePublished">更新 Jan 13, 2015</time></p>
        </header>
        <p>Python のパッケージ管理関係の情報がオフィシャルには整理されてなく、
またパッケージ管理まわりででてくるキーワードもいくつもあって分かり難いので完結にまとめてみました。
このドキュメント自体は少し長いですが、結論としては2015年1月時点では</p>

<ul>
  <li>原則 pip を使ってパッケージの管理を行う</li>
  <li>setuptools も広く使われているので入れておくとよい。そもそも pip
のインストール時に自動的ににインストールされる</li>
  <li>distribute は 2013年に setuptools にマージされたので不要</li>
</ul>

<p>という方針でよいと思います。</p>

<p>ただ少し古い情報ソースやパッケージのドキュメントを読んでいると
distribute の利用が勧められていたり、 site-packages, easy_install,
ez_setup.py, distutils, PyPI, Eggs, etc…
と色々なキーワードが出て来て、
それぞれが何なのかを理解していないと混乱してしまいます。
そのため、それぞれの技術と技術同士の関係を理解しておくのは Python
で正しくパッケージ管理を行う上で大切かと思います。</p>

<ul id="markdown-toc">
  <li><a href="#section">キーワード</a></li>
  <li><a href="#section-1">事前知識</a>    <ul>
      <li><a href="#site-packages">site-packages</a></li>
      <li><a href="#user-site-directory">User site directory</a></li>
      <li><a href="#pypi">PyPI</a></li>
    </ul>
  </li>
  <li><a href="#distutils">distutils</a>    <ul>
      <li><a href="#distutils-basic">基本</a></li>
      <li><a href="#distutils-">distutils における依存関係の扱い</a></li>
    </ul>
  </li>
  <li><a href="#distribute">distribute</a></li>
  <li><a href="#setuptools">setuptools</a>    <ul>
      <li><a href="#section-2">インストール</a></li>
      <li><a href="#section-3">参考文献</a></li>
    </ul>
  </li>
  <li><a href="#easy-install">easy_install</a>    <ul>
      <li><a href="#easyinstall-">easy_install の使い方</a></li>
      <li><a href="#section-4">文献</a></li>
    </ul>
  </li>
  <li><a href="#python-eggs">Python Eggs</a></li>
  <li><a href="#ez-setup">ez_setup.py</a></li>
  <li><a href="#pip">pip</a>    <ul>
      <li><a href="#section-5">インストール &amp; アップグレード</a></li>
      <li><a href="#section-6">使い方</a></li>
    </ul>
  </li>
  <li><a href="#wheels">Wheels</a>    <ul>
      <li><a href="#section-7">インストール</a></li>
      <li><a href="#wheel">Wheelの作成</a></li>
    </ul>
  </li>
  <li><a href="#section-8">その他</a></li>
  <li><a href="#section-9">参考文献</a></li>
</ul>

<h1 id="section">キーワード</h1>

<p>Python
におけるパッケージ管理に関係のあるキーワードをアルファベット順に。</p>

<ul>
  <li><a href="#easy-install">easy_install</a>
    <ul>
      <li>setuptools に付属しているコマンドラインツール。easy_install
を使うと簡単なコマンドで web 上 (e.g. PyPI) から
パッケージをダウンロードしてインストールすることができる。</li>
    </ul>
  </li>
  <li><a href="#ez-setup">ez_setup.py</a>
    <ul>
      <li>setuptools をインストールする際に利用されるスクリプトの名前。</li>
    </ul>
  </li>
  <li><a href="#distribute">distribute</a>
    <ul>
      <li>setuptools の更新が停滞していた時に発生した setuptools
のクローン。 2013年に setuptools とマージされたので、distribute
のことは気にする必要はないはず。</li>
    </ul>
  </li>
  <li><a href="#distutils">distutils</a>
    <ul>
      <li>Python 標準のパッケージ管理の基本的な機能を提供するモジュール
(import distutils)。 setuptools が distutils
の高機能版で広く使われているので setuptools を使うのが一般的。</li>
    </ul>
  </li>
  <li><a href="#setuptools">setuptools</a>
    <ul>
      <li>distutils を強化したパッケージ管理用の setuptools
というモジュールと、 easy_install
というコマンドラインツールのセット。</li>
    </ul>
  </li>
  <li><a href="#distutils-basic">setup.py</a>
    <ul>
      <li>setuptools, distutils
でパッケージの定義を記述するスクリプトに使われるファイル名。
作成されたパッケージをインストールする際にも利用される。</li>
    </ul>
  </li>
  <li><a href="#pip">pip</a>
    <ul>
      <li>easy_install の強化版ツール</li>
    </ul>
  </li>
  <li><a href="#pypi">PyPI</a>
    <ul>
      <li>the Python Package Index。だれでも Python
のパッケージが登録できる python.org のサイト。 easy_install
とか pip
は基本的にここからパッケージを探してきてインストールしてくれる。</li>
    </ul>
  </li>
  <li><a href="#python-eggs">Python Eggs</a>
    <ul>
      <li>setuptools で定義された Python の配布形式。 Python
のコードやメタ情報その他を所定のフォーマットに従って zip
で固めたもの (distutils の生成するzip/tar の拡張版)。 setuptools
を使って (つまり setuptools を使って setup.py を定義していれば)
作成することができる。</li>
    </ul>
  </li>
  <li><a href="https://www.python.org/dev/peps/pep-0427/">Python Wheels</a>
    <ul>
      <li>Python Eggs の後継のフォーマット。</li>
    </ul>
  </li>
  <li>その他
    <ul>
      <li>buildout, virtualenv</li>
    </ul>
  </li>
</ul>

<h1 id="section-1">事前知識</h1>

<h2 id="site-packages">site-packages</h2>

<ul>
  <li>Python には <code>site-packages</code> というディレクトリが存在し、そのサイト
(マシン環境) 固有のモジュールは site-packages
に保存されるようになっている。</li>
  <li>site-packages が モジュールの探索パス (sys.path)
に足された後、sitecustomize というモジュールが暗黙的に Python に
import される。 sitecustomize
にサイト固有の設定を書いておくことができる。<code>sys.setdefaultencoding('utf-8')</code>
でエンコーディングを設定するのによく使われる。</li>
  <li>sitecustomize.py は sys.path
が通っているディレクトリならどこにおいてもよいけど、site-packages
に置くのが自然である。</li>
  <li>ちなみに site-packages と似た、site-python
というのも存在するらしいが、あまり使われていないし、
<a href="https://docs.python.org/3.4/library/site.html">site-pythonはPython
3.5で廃止される</a>
ようなので気にしなくてよい。</li>
  <li>参考文献
    <ul>
      <li><a href="http://docs.python.org/2/install/#how-installation-works">http://docs.python.org/2/install/#how-installation-works</a></li>
      <li><a href="http://docs.python.org/2/library/site.html">http://docs.python.org/2/library/site.html</a></li>
    </ul>
  </li>
</ul>

<h2 id="user-site-directory">User site directory</h2>

<ul>
  <li>Python 2.6 から <code>per user site-packages</code>
というものが存在していて、ユーザ毎のモジュールを保存することができる。</li>
  <li><code>per user site-packages</code> を使えば site-packages
にアクセス権がないユーザ (環境標準の Python
を使っているならすべての非rootユーザ) も site-packages
にモジュールが簡単にインストールできる。</li>
  <li>per user site-packages のパスは、 <code>site.UER_SITE</code> で参照できる。
Linux だと <code>$HOME/.local/lib/pythonX.Y/site-packages</code>。 Macだと
<code>$HOME/Library/Python/X.Y/lib/python/site-packages</code></li>
  <li>Python 2.6 以降は Virtual Python
とかをユーザ毎の環境を作るためだけに使う必要はない。もちろん
isolated な環境を作るのには依然として有益である。</li>
  <li>参考文献
    <ul>
      <li><a href="http://legacy.python.org/dev/peps/pep-0370/">PEP 0370 Per user site-packages
directory</a></li>
      <li><a href="http://docs.python.org/2/library/site.html">http://docs.python.org/2/library/site.html</a></li>
    </ul>
  </li>
</ul>

<h2 id="pypi">PyPI</h2>

<p><a href="https://pypi.python.org/pypi">PyPI: the Python Package Index</a>。
だれでも Python のパッケージが登録できる python.org のサイト。 後述の
easy_install とか pip
はここからパッケージを探してきてインストールしてくれる。</p>

<h1 id="distutils">distutils</h1>

<ul>
  <li>Python
標準のパッケージ管理用のモジュール。パッケージ管理の基本的な機能を提供する。</li>
  <li>setuptools や pip などのその他のパッケージ管理システムは distutils
に機能を拡張するものである。</li>
  <li>パッケージ管理について理解するにはまず distutils
の基本は理解しておいたほうがよいかもしれない。</li>
  <li>しかしパッケージ作成に実際に使うのは distutils の拡張である
setuptools だろうから、distutils
の仕様をそこまで細かく理解しておく必要はあまりないかも。</li>
</ul>

<h2 id="distutils-basic">基本</h2>

<p>Python のソースコードの入ったディレクトリに:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'foo'</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">'1.0'</span><span class="p">,</span>
      <span class="n">py_modules</span><span class="o">=</span><span class="p">[</span><span class="s">'foo'</span><span class="p">],</span>
      <span class="p">)</span></code></pre></div>

<p>のような setup.py というファイルを用意する。 この例では foo
というモジュールがあるモジュール配布物 (module distribution)
を定義している。 setup.py ができたら、:</p>

<pre><code>python setup.py sdist
</code></pre>

<p>を実行する。そうすると、dist というディレクトリに module distribution の
.zip や .tar.gz ファイルが作成される。これを配布すれば良い。
配布されたパッケージをインストールするには、sdist
で作成されたファイルをダウンロード・解凍して、展開先のディレクトリで:</p>

<pre><code>python setup.py install
</code></pre>

<p>を実行すればよい。site-packages にインストールが行われる。
<code>User site directory</code> にインストールしたい場合には、 <a href="https://docs.python.org/2/install/index.html#alternate-installation-the-user-scheme">install コマンドに
–user
オプションを付ける</a>。
<code>--user</code>
オプションを付ければ、非rootユーザも自分のホームディレクトリにモジュール配布物をインストールすることができる。
その他のコマンドの一覧は:</p>

<pre><code>python setup.py --help-commands
</code></pre>

<p>で表示できる。</p>

<h2 id="distutils-">distutils における依存関係の扱い</h2>

<p><a href="https://docs.python.org/2/distutils/setupscript.html#relationships-between-distributions-and-packages">distutils ドキュメントには、setup に渡す requires
パラメータで依存関係が定義できる</a>
という下りがあるが、 <a href="https://docs.python.org/2.7/distutils/apiref.html">setup
のパラメータ一覧</a>
には requires はないようにみえる。整合性が取れていなくてよく分からない。
<a href="http://legacy.python.org/dev/peps/pep-0314/">PEP314</a> にはrequires
に関する言及がある。 おそらく現行(2.7)の distutils
では依存関係の宣言とそれによるインストールはサポートされていない。</p>

<h1 id="distribute">distribute</h1>

<p>setuptoolsのクローン。setuptools の開発が進まないので、 distribute
という setuptools のブランチが作成されていた。 少し古いページでは
distribute のインストールが勧められていることも多い。 しかし、<a href="http://pythonhosted.org/setuptools/merge.html">2013年に
distribute は setuptools
にマージされた</a>
ので今後は distribute を使う必要はないと思われる。</p>

<h1 id="setuptools">setuptools</h1>

<p>distutils を拡張するライブラリと easy_install
というモジュールのインストールを行う補助コマンドのセット。
更新が停止していたので、代替として distribute が開発されていたが
distribute は2013年にマージされたので、今後はsetuptools を使えば良い。</p>

<h2 id="section-2">インストール</h2>

<p>ez_setup.py
というブートストラップ用のスクリプトをダウンロードし実行する。:</p>

<pre><code>wget https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py
python ez_setup.py
</code></pre>

<p>前述の User site directory にインストールする場合には、:</p>

<pre><code>python ez_setup.py --user
</code></pre>

<p>を実行する。 Mac の Python には始めから入っているような気がする。:</p>

<pre><code>/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/setuptools
</code></pre>

<h2 id="section-3">参考文献</h2>

<p><a href="https://pypi.python.org/pypi/setuptools">https://pypi.python.org/pypi/setuptools</a></p>

<h1 id="easy-install">easy_install</h1>

<p>簡単に PyPI
や指定されたURLにあるアーカイブからモジュールのインストールが行えるコマンド。
setuptools に付随している。パッケージを自作しないユーザが setuptols
を入れる直接的な理由のほとんどはこれをインストールするためであろう。</p>

<h2 id="easyinstall-">easy_install の使い方</h2>

<ul>
  <li>PyPI から最新版をダウンロードしてインストール
    <ul>
      <li>easy_install SQLObject</li>
    </ul>
  </li>
  <li>アーカイブをダウンロードしてインストール
    <ul>
      <li>easy_install <a href="http://example.com/path/to/MyPackage-1.2.3.tgz">http://example.com/path/to/MyPackage-1.2.3.tgz</a></li>
    </ul>
  </li>
  <li><code>User site directory</code> へインストール
    <ul>
      <li>前述の ez_setup.py に –user を付けて setuptools
とそれに付随する easy_install を User site directory
にインストールした場合は、 easy_install
によってインストールされるパッケージもデフォルトで User site
directory にインストールされる。</li>
      <li>/usr/bin/easy_install のような環境にインストールされている
easy_install を利用してUser site directory
にパッケージをインストールしたい場合には、 –user
オプションをつければよい。 ただ、Mac OS に付随している
setuptools は古いのか –user が何故か使えない…ので、
easy_install 自体を User site directory
に自分でインストールしてそちらを使うほうが良い模様。</li>
      <li><a href="https://pythonhosted.org/setuptools/easy_install.html#downloading-and-installing-a-package">その他の使い方</a></li>
    </ul>
  </li>
</ul>

<h2 id="section-4">文献</h2>

<ul>
  <li><a href="https://pythonhosted.org/setuptools/easy_install.html">easy_install
documentation</a></li>
</ul>

<h1 id="python-eggs">Python Eggs</h1>

<p><a href="http://peak.telecommunity.com/DevCenter/PythonEggs">setuptools で定義された Python
の配布形式</a>。 Python
のコードやメタ情報その他を所定のフォーマットに従って zip で固めたもの
(distutils の生成するzip/tar の拡張版)。 setuptools を使って (つまり
setuptools を使って setup.py を定義していれば) 作成することができる。</p>

<h1 id="ez-setup">ez_setup.py</h1>

<p>上述したように、setuptools
のインストールに利用されるブートストラップ用のスクリプト。</p>

<h1 id="pip">pip</h1>

<p><a href="https://pip.pypa.io/en/latest/">pip</a> はeasy_install の強化版です。
パッケージのアンインストールなど、easy_install
にはない機能が提供されています。 2014年12月現在、pip を使うのが Python
における最もモダンなパッケージ管理方法だと思います。</p>

<h2 id="section-5">インストール &amp; アップグレード</h2>

<ul>
  <li>wget “<a href="https://bootstrap.pypa.io/get-pip.py">https://bootstrap.pypa.io/get-pip.py</a>”</li>
  <li>rootにインストールする場合
    <ul>
      <li>sudo python get-pip.py</li>
    </ul>
  </li>
  <li>非rootで User site directory にインストール場合
    <ul>
      <li>python get-pip.py –user</li>
    </ul>
  </li>
  <li>pip 自体をアップデートする
    <ul>
      <li>pip install -U pip</li>
    </ul>
  </li>
</ul>

<h2 id="section-6">使い方</h2>

<ul>
  <li>PyPI から最新版をダウンロードしてインストール
    <ul>
      <li>pip install SQLObject</li>
    </ul>
  </li>
  <li><code>User site directory</code> へインストール
    <ul>
      <li>pip install –user SQLObject</li>
      <li>easy_install と違って –user 付きでインストールした pip
もデフォルトでは root に
パッケージをインストールしようとするので、 User site directory
にインストールしたい場合は <code>--user</code> は省略できない。</li>
    </ul>
  </li>
</ul>

<h1 id="wheels">Wheels</h1>

<ul>
  <li><a href="https://wheel.readthedocs.org/en/latest/">Wheel</a></li>
</ul>

<h2 id="section-7">インストール</h2>

<pre><code>pip install wheel
(必要ならば --user をつける)
</code></pre>

<h2 id="wheel">Wheelの作成</h2>

<ul>
  <li>setup.py が setuptools を使って書かれていれば、 wheel
をインストールすることで bdist_wheel が使えるようになります。</li>
</ul>

<h1 id="section-8">その他</h1>

<ul>
  <li><a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>
    <ul>
      <li>Python の isolated な仮想環境を <code>virtualenv ENV</code>
コマンド一発で作り出す超便利ツール。</li>
      <li>仮想環境毎に別々のパッケージがインストールできるので、クリーンな環境を作ったり、
アプリケーションによって異なるバージョンのパッケージを使ったりするのに便利。</li>
      <li>root
権限がないユーザがパッケージを入れるのにも便利ではあるが、2.6以降は
<code>User site directory</code> があるので virtualenv
を使わなくても非rootユーザ毎にパッケージを入れるのは簡単。</li>
    </ul>
  </li>
</ul>

<h1 id="section-9">参考文献</h1>

<ul>
  <li><a href="http://www.freia.jp/taka/docs/pyhack4/index.html">Python Hack-a-thon 4 ハンズオン
中級コース</a>
日本語でよくまとまっていてわかりやすい。</li>
  <li><a href="https://packaging.python.org/en/latest/">Python Packaging User
Guide</a>
    <ul>
      <li>ついに Python のパッケージ管理の情報が公式に整理され始めた？</li>
    </ul>
  </li>
  <li><a href="https://www.pypa.io/en/latest/">Python Packaging Authority</a>
    <ul>
      <li><a href="https://www.pypa.io/en/latest/history/">Packaging History</a>
とか2014になってからまとめ始めている</li>
    </ul>
  </li>
</ul>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li></li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
